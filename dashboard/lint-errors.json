
> dashboard@1.0.0 lint
> eslint . --format json

[{"filePath":"/home/run0/whitelist/dashboard/src/db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/run0/whitelist/dashboard/src/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/home/run0/whitelist/dashboard/src/public/js/app.ts","messages":[{"ruleId":"@typescript-eslint/no-inferrable-types","severity":2,"message":"Type string trivially inferred from a string literal, remove type annotation.","line":41,"column":5,"nodeType":"VariableDeclarator","messageId":"noInferrableType","endLine":41,"endColumn":42,"fix":{"range":[659,667],"text":""}},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":52,"column":37,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":52,"endColumn":39,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[1119,1121],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-confusing-void-expression","severity":2,"message":"Returning a void expression from an arrow function shorthand is forbidden. Please add braces to the arrow function.","line":66,"column":22,"nodeType":"CallExpression","messageId":"invalidVoidExprArrow","endLine":66,"endColumn":36,"fix":{"range":[1583,1597],"text":"{ toast.remove(); }"}},{"ruleId":"@typescript-eslint/no-confusing-void-expression","severity":2,"message":"Returning a void expression from an arrow function shorthand is forbidden. Please add braces to the arrow function.","line":71,"column":55,"nodeType":"CallExpression","messageId":"invalidVoidExprArrow","endLine":71,"endColumn":80,"fix":{"range":[1750,1775],"text":"{ s.classList.add('hidden'); }"}},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise returned in function argument where a void return was expected.","line":95,"column":42,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnArgument","endLine":113,"endColumn":6},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary conditional, value is always falsy.","line":101,"column":13,"nodeType":"UnaryExpression","messageId":"alwaysFalsy","endLine":101,"endColumn":24},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary conditional, value is always falsy.","line":101,"column":28,"nodeType":"UnaryExpression","messageId":"alwaysFalsy","endLine":101,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3168,3171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3168,3171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":111,"column":13,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":111,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":111,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":111,"endColumn":46},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise returned in function argument where a void return was expected.","line":118,"column":41,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnArgument","endLine":121,"endColumn":6},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":156,"column":58,"nodeType":"MemberExpression","messageId":"invalidType","endLine":156,"endColumn":62},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":161,"column":44,"nodeType":"MemberExpression","messageId":"invalidType","endLine":161,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5435,5438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5435,5438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .openNewGroupModal on an `any` value.","line":174,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":174,"endColumn":34},{"ruleId":"@typescript-eslint/explicit-function-return-type","severity":2,"message":"Missing return type on function.","line":174,"column":40,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":174,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5517,5520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5517,5520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .openGroup on an `any` value.","line":178,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":178,"endColumn":26},{"ruleId":"@typescript-eslint/explicit-function-return-type","severity":2,"message":"Missing return type on function.","line":178,"column":42,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":178,"endColumn":44},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":187,"column":51,"nodeType":"Identifier","messageId":"invalidType","endLine":187,"endColumn":53},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary conditional, value is always truthy.","line":195,"column":9,"nodeType":"Identifier","messageId":"alwaysTruthy","endLine":195,"endColumn":25},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary conditional, value is always truthy.","line":196,"column":9,"nodeType":"Identifier","messageId":"alwaysTruthy","endLine":196,"endColumn":21},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":217,"column":49,"nodeType":"Identifier","messageId":"invalidType","endLine":217,"endColumn":63},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary optional chain on a non-nullish value.","line":225,"column":28,"nodeType":"MemberExpression","messageId":"neverOptionalChain","endLine":225,"endColumn":30,"suggestions":[{"messageId":"suggestRemoveOptionalChain","fix":{"range":[7155,7157],"text":"."},"desc":"Remove unnecessary optional chain"}]},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":245,"column":86,"nodeType":"MemberExpression","messageId":"invalidType","endLine":245,"endColumn":90},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":250,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7926,7929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7926,7929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .deleteRule on an `any` value.","line":250,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":250,"endColumn":27},{"ruleId":"@typescript-eslint/explicit-function-return-type","severity":2,"message":"Missing return type on function.","line":250,"column":57,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":250,"endColumn":59},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":271,"column":42,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":271,"endColumn":44,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[8691,8693],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-confusing-void-expression","severity":2,"message":"Returning a void expression from an arrow function shorthand is forbidden. Please add braces to the arrow function.","line":272,"column":57,"nodeType":"CallExpression","messageId":"invalidVoidExprArrow","endLine":272,"endColumn":86,"fix":{"range":[8763,8792],"text":"{ el.classList.remove('active'); }"}},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise returned in function argument where a void return was expected.","line":294,"column":45,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnArgument","endLine":310,"endColumn":6},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary optional chain on a non-nullish value.","line":299,"column":42,"nodeType":"MemberExpression","messageId":"neverOptionalChain","endLine":299,"endColumn":44,"suggestions":[{"messageId":"suggestRemoveOptionalChain","fix":{"range":[9650,9652],"text":"."},"desc":"Remove unnecessary optional chain"}]},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary optional chain on a non-nullish value.","line":300,"column":34,"nodeType":"MemberExpression","messageId":"neverOptionalChain","endLine":300,"endColumn":36,"suggestions":[{"messageId":"suggestRemoveOptionalChain","fix":{"range":[9698,9700],"text":"."},"desc":"Remove unnecessary optional chain"}]},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":302,"column":34,"nodeType":"Identifier","messageId":"invalidType","endLine":302,"endColumn":48},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise returned in function argument where a void return was expected.","line":316,"column":46,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnArgument","endLine":324,"endColumn":6},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":320,"column":34,"nodeType":"Identifier","messageId":"invalidType","endLine":320,"endColumn":48},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":2,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":332,"column":44,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":332,"endColumn":46,"suggestions":[{"messageId":"suggestNullish","data":{"equals":""},"fix":{"range":[10782,10784],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":343,"column":29,"nodeType":"Identifier","messageId":"invalidType","endLine":343,"endColumn":31},{"ruleId":"@typescript-eslint/no-confusing-void-expression","severity":2,"message":"Returning a void expression from an arrow function shorthand is forbidden. Please add braces to the arrow function.","line":377,"column":62,"nodeType":"CallExpression","messageId":"invalidVoidExprArrow","endLine":377,"endColumn":90,"fix":{"range":[12107,12135],"text":"{ openModal('modal-new-group'); }"}},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary conditional, value is always truthy.","line":380,"column":5,"nodeType":"Identifier","messageId":"alwaysTruthy","endLine":380,"endColumn":17},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise returned in function argument where a void return was expected.","line":381,"column":45,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnArgument","endLine":398,"endColumn":6},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":395,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":395,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12880,12883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12880,12883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":396,"column":23,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":396,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":396,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":396,"endColumn":34},{"ruleId":"@typescript-eslint/no-confusing-void-expression","severity":2,"message":"Returning a void expression from an arrow function shorthand is forbidden. Please add braces to the arrow function.","line":403,"column":60,"nodeType":"CallExpression","messageId":"invalidVoidExprArrow","endLine":403,"endColumn":87,"fix":{"range":[13084,13111],"text":"{ openModal('modal-add-rule'); }"}},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary conditional, value is always truthy.","line":406,"column":5,"nodeType":"Identifier","messageId":"alwaysTruthy","endLine":406,"endColumn":16},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise returned in function argument where a void return was expected.","line":407,"column":44,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnArgument","endLine":425,"endColumn":6},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":414,"column":38,"nodeType":"Identifier","messageId":"invalidType","endLine":414,"endColumn":52},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13929,13932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13929,13932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":423,"column":23,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":423,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":423,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":423,"endColumn":34},{"ruleId":"@typescript-eslint/no-confusing-void-expression","severity":2,"message":"Returning a void expression from an arrow function shorthand is forbidden. Please add braces to the arrow function.","line":430,"column":60,"nodeType":"CallExpression","messageId":"invalidVoidExprArrow","endLine":430,"endColumn":87,"fix":{"range":[14133,14160],"text":"{ openModal('modal-bulk-add'); }"}},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary conditional, value is always truthy.","line":433,"column":5,"nodeType":"Identifier","messageId":"alwaysTruthy","endLine":433,"endColumn":16},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise returned in function argument where a void return was expected.","line":434,"column":44,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnArgument","endLine":458,"endColumn":6},{"ruleId":"@typescript-eslint/no-unnecessary-condition","severity":2,"message":"Unnecessary optional chain on a non-nullish value.","line":438,"column":28,"nodeType":"MemberExpression","messageId":"neverOptionalChain","endLine":438,"endColumn":30,"suggestions":[{"messageId":"suggestRemoveOptionalChain","fix":{"range":[14508,14510],"text":"."},"desc":"Remove unnecessary optional chain"}]},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":2,"message":"Invalid type \"number\" of template literal expression.","line":447,"column":72,"nodeType":"Identifier","messageId":"invalidType","endLine":447,"endColumn":86},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":455,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":455,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15159,15162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15159,15162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":456,"column":23,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":456,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":456,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":456,"endColumn":34},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise returned in function argument where a void return was expected.","line":507,"column":47,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnArgument","endLine":528,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":525,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":525,"endColumn":21}],"suppressedMessages":[],"errorCount":61,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":7,"fixableWarningCount":0,"source":"/**\n * OpenPath - Strict Internet Access Control\n * Copyright (C) 2025 OpenPath Authors\n */\n\n// ============== State ==============\ninterface Rule {\n    id: number;\n    type: string;\n    value: string;\n}\n\ninterface Group {\n    id: number;\n    name: string;\n    display_name: string;\n    whitelist_count: number;\n    enabled: boolean;\n}\n\ninterface Stats {\n    groupCount: number;\n    whitelistCount: number;\n    blockedCount: number;\n}\n\ninterface SystemStatus {\n    enabled: boolean;\n}\n\ninterface User {\n    username: string;\n}\n\ninterface AuthCheck {\n    authenticated: boolean;\n    user?: User;\n}\n\nlet currentGroupId: number | null = null;\nlet currentRuleType: string = 'whitelist';\nlet allRules: Rule[] = [];\n\n// ============== API Helpers ==============\nasync function api<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    const res = await fetch(endpoint, {\n        headers: { 'Content-Type': 'application/json' },\n        ...options\n    });\n    if (!res.ok) {\n        const error = await res.json().catch(() => ({ error: 'Error de red' })) as { error?: string };\n        throw new Error(error.error || 'Error desconocido');\n    }\n    return res.json() as Promise<T>;\n}\n\n// ============== Toast ==============\nfunction showToast(message: string, type: 'success' | 'error' = 'success'): void {\n    const container = document.getElementById('toast-container');\n    if (!container) return;\n\n    const toast = document.createElement('div');\n    toast.className = `toast ${type}`;\n    toast.textContent = message;\n    container.appendChild(toast);\n    setTimeout(() => toast.remove(), 3000);\n}\n\n// ============== Screens ==============\nfunction showScreen(screenId: string): void {\n    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));\n    const screen = document.getElementById(screenId);\n    if (screen) screen.classList.remove('hidden');\n}\n\n// ============== Auth ==============\nasync function checkAuth(): Promise<void> {\n    try {\n        const data = await api<AuthCheck>('/api/auth/check');\n        if (data.authenticated && data.user) {\n            const userEl = document.getElementById('current-user');\n            if (userEl) userEl.textContent = data.user.username;\n            showScreen('dashboard-screen');\n            void loadDashboard();\n        } else {\n            showScreen('login-screen');\n        }\n    } catch {\n        showScreen('login-screen');\n    }\n}\n\nconst loginForm = document.getElementById('login-form');\nif (loginForm) {\n    loginForm.addEventListener('submit', async (e) => {\n        e.preventDefault();\n        const usernameEl = document.getElementById('username') as HTMLInputElement;\n        const passwordEl = document.getElementById('password') as HTMLInputElement;\n        const errorEl = document.getElementById('login-error');\n\n        if (!usernameEl || !passwordEl || !errorEl) return;\n\n        try {\n            await api('/api/auth/login', {\n                method: 'POST',\n                body: JSON.stringify({ username: usernameEl.value, password: passwordEl.value })\n            });\n            errorEl.textContent = '';\n            void checkAuth();\n        } catch (err: any) {\n            errorEl.textContent = err.message;\n        }\n    });\n}\n\nconst logoutBtn = document.getElementById('logout-btn');\nif (logoutBtn) {\n    logoutBtn.addEventListener('click', async () => {\n        await api('/api/auth/logout', { method: 'POST' });\n        showScreen('login-screen');\n    });\n}\n\n// ============== Dashboard ==============\nasync function loadDashboard(): Promise<void> {\n    try {\n        // Stats\n        const stats = await api<Stats>('/api/stats');\n        const statGroups = document.getElementById('stat-groups');\n        const statWhitelist = document.getElementById('stat-whitelist');\n        const statBlocked = document.getElementById('stat-blocked');\n\n        if (statGroups) statGroups.textContent = stats.groupCount.toString();\n        if (statWhitelist) statWhitelist.textContent = stats.whitelistCount.toString();\n        if (statBlocked) statBlocked.textContent = stats.blockedCount.toString();\n\n        // System status\n        void loadSystemStatus();\n\n        // Groups\n        const groups = await api<Group[]>('/api/groups');\n        const list = document.getElementById('groups-list');\n        if (!list) return;\n\n        if (groups.length === 0) {\n            list.innerHTML = `\n                <div class=\"empty-state\">\n                    <p>No hay grupos configurados</p>\n                    <button class=\"btn btn-primary\" onclick=\"openNewGroupModal()\">Crear primer grupo</button>\n                </div>\n            `;\n            return;\n        }\n\n        list.innerHTML = groups.map(g => `\n            <div class=\"group-card\" onclick=\"openGroup(${g.id})\">\n                <div class=\"group-info\">\n                    <h3>${escapeHtml(g.display_name)}</h3>\n                    <p>${g.name}.txt</p>\n                </div>\n                <div class=\"group-stats\">${g.whitelist_count} dominios</div>\n                <span class=\"group-status ${g.enabled ? 'active' : 'paused'}\">\n                    ${g.enabled ? '‚úÖ Activo' : '‚è∏Ô∏è Pausado'}\n                </span>\n                <span class=\"btn btn-ghost\">‚Üí</span>\n            </div>\n        `).join('');\n    } catch (err) {\n        console.error('Error loading dashboard:', err);\n    }\n}\n\n// Attach to window for onclick handlers in generated HTML\n(window as any).openNewGroupModal = () => {\n    openModal('modal-new-group');\n};\n\n(window as any).openGroup = (id: number) => {\n    void openGroup(id);\n};\n\n// ============== Group Editor ==============\nasync function openGroup(id: number): Promise<void> {\n    currentGroupId = id;\n    currentRuleType = 'whitelist';\n\n    const group = await api<Group>(`/api/groups/${id}`);\n\n    const editorTitle = document.getElementById('editor-title');\n    const groupDisplayName = document.getElementById('group-display-name') as HTMLInputElement;\n    const groupEnabled = document.getElementById('group-enabled') as HTMLSelectElement;\n    const exportUrl = document.getElementById('export-url');\n\n    if (editorTitle) editorTitle.textContent = group.display_name;\n    if (groupDisplayName) groupDisplayName.value = group.display_name;\n    if (groupEnabled) groupEnabled.value = group.enabled ? '1' : '0';\n\n    if (exportUrl) {\n        const baseUrl = window.location.origin;\n        exportUrl.textContent = `${baseUrl}/export/${group.name}.txt`;\n    }\n\n    // Load rules\n    void loadRules();\n\n    // Update tabs\n    document.querySelectorAll('.tab').forEach(t => {\n        const tab = t as HTMLElement;\n        tab.classList.toggle('active', tab.dataset.type === currentRuleType);\n    });\n\n    showScreen('editor-screen');\n}\n\nasync function loadRules(): Promise<void> {\n    if (currentGroupId === null) return;\n    allRules = await api<Rule[]>(`/api/groups/${currentGroupId}/rules`);\n    renderRules();\n    updateRuleCounts();\n}\n\nfunction renderRules(): void {\n    const filtered = allRules.filter(r => r.type === currentRuleType);\n    const searchEl = document.getElementById('search-rules') as HTMLInputElement;\n    const search = searchEl?.value.toLowerCase() || '';\n    const displayed = search\n        ? filtered.filter(r => r.value.toLowerCase().includes(search))\n        : filtered;\n\n    const list = document.getElementById('rules-list');\n    if (!list) return;\n\n    if (displayed.length === 0) {\n        list.innerHTML = `\n            <div class=\"empty-state\">\n                <p>${search ? 'No hay resultados' : 'No hay reglas en esta secci√≥n'}</p>\n            </div>\n        `;\n        return;\n    }\n\n    list.innerHTML = displayed.map(r => `\n        <div class=\"rule-item\">\n            <span class=\"rule-value\">${escapeHtml(r.value)}</span>\n            <button class=\"btn btn-ghost btn-icon rule-delete\" onclick=\"deleteRule(${r.id}, event)\">üóëÔ∏è</button>\n        </div>\n    `).join('');\n}\n\n(window as any).deleteRule = (id: number, event: Event) => {\n    void deleteRule(id, event);\n};\n\nfunction updateRuleCounts(): void {\n    const counts = {\n        whitelist: allRules.filter(r => r.type === 'whitelist').length,\n        blocked_subdomain: allRules.filter(r => r.type === 'blocked_subdomain').length,\n        blocked_path: allRules.filter(r => r.type === 'blocked_path').length\n    };\n\n    Object.entries(counts).forEach(([type, count]) => {\n        const badge = document.getElementById(`count-${type}`);\n        if (badge) badge.textContent = count.toString();\n    });\n}\n\n// Tab switching\ndocument.querySelectorAll('.tab').forEach(tab => {\n    tab.addEventListener('click', () => {\n        const t = tab as HTMLElement;\n        currentRuleType = t.dataset.type || 'whitelist';\n        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));\n        t.classList.add('active');\n        renderRules();\n    });\n});\n\n// Search\nconst searchRules = document.getElementById('search-rules');\nif (searchRules) searchRules.addEventListener('input', renderRules);\n\n// Back button\nconst backBtn = document.getElementById('back-btn');\nif (backBtn) {\n    backBtn.addEventListener('click', () => {\n        showScreen('dashboard-screen');\n        void loadDashboard();\n    });\n}\n\n// Save config\nconst saveConfigBtn = document.getElementById('save-config-btn');\nif (saveConfigBtn) {\n    saveConfigBtn.addEventListener('click', async () => {\n        if (currentGroupId === null) return;\n        const displayNameEl = document.getElementById('group-display-name') as HTMLInputElement;\n        const enabledEl = document.getElementById('group-enabled') as HTMLSelectElement;\n\n        const displayName = displayNameEl?.value || '';\n        const enabled = enabledEl?.value === '1';\n\n        await api(`/api/groups/${currentGroupId}`, {\n            method: 'PUT',\n            body: JSON.stringify({ displayName, enabled })\n        });\n\n        const editorTitle = document.getElementById('editor-title');\n        if (editorTitle) editorTitle.textContent = displayName;\n        showToast('Configuraci√≥n guardada');\n    });\n}\n\n// Delete group\nconst deleteGroupBtn = document.getElementById('delete-group-btn');\nif (deleteGroupBtn) {\n    deleteGroupBtn.addEventListener('click', async () => {\n        if (currentGroupId === null) return;\n        if (!confirm('¬øEliminar este grupo y todas sus reglas?')) return;\n\n        await api(`/api/groups/${currentGroupId}`, { method: 'DELETE' });\n        showToast('Grupo eliminado');\n        showScreen('dashboard-screen');\n        void loadDashboard();\n    });\n}\n\n// Copy URL\nconst copyUrlBtn = document.getElementById('copy-url-btn');\nif (copyUrlBtn) {\n    copyUrlBtn.addEventListener('click', () => {\n        const exportUrl = document.getElementById('export-url');\n        const url = exportUrl?.textContent || '';\n        if (url) {\n            void navigator.clipboard.writeText(url);\n            showToast('URL copiada al portapapeles');\n        }\n    });\n}\n\n// Delete rule\nasync function deleteRule(id: number, event: Event): Promise<void> {\n    event.stopPropagation();\n    await api(`/api/rules/${id}`, { method: 'DELETE' });\n    allRules = allRules.filter(r => r.id !== id);\n    renderRules();\n    updateRuleCounts();\n    showToast('Regla eliminada');\n}\n\n// ============== Modals ==============\nfunction openModal(id: string): void {\n    const modal = document.getElementById(id);\n    if (modal) modal.classList.remove('hidden');\n}\n\nfunction closeModal(id: string): void {\n    const modal = document.getElementById(id);\n    if (modal) modal.classList.add('hidden');\n}\n\n// Close on background click or cancel\ndocument.querySelectorAll('.modal').forEach(modal => {\n    modal.addEventListener('click', (e) => {\n        if (e.target === modal) closeModal(modal.id);\n    });\n});\n\ndocument.querySelectorAll('.modal-close, .modal-cancel').forEach(btn => {\n    btn.addEventListener('click', () => {\n        const modal = btn.closest('.modal');\n        if (modal) closeModal(modal.id);\n    });\n});\n\n// New Group\nconst newGroupBtn = document.getElementById('new-group-btn');\nif (newGroupBtn) newGroupBtn.addEventListener('click', () => openModal('modal-new-group'));\n\nconst newGroupForm = document.getElementById('new-group-form') as HTMLFormElement;\nif (newGroupForm) {\n    newGroupForm.addEventListener('submit', async (e) => {\n        e.preventDefault();\n        const nameEl = document.getElementById('new-group-name') as HTMLInputElement;\n        const displayNameEl = document.getElementById('new-group-display') as HTMLInputElement;\n\n        try {\n            await api('/api/groups', {\n                method: 'POST',\n                body: JSON.stringify({ name: nameEl.value, displayName: displayNameEl.value })\n            });\n            closeModal('modal-new-group');\n            newGroupForm.reset();\n            showToast('Grupo creado');\n            void loadDashboard();\n        } catch (err: any) {\n            showToast(err.message, 'error');\n        }\n    });\n}\n\n// Add Rule\nconst addRuleBtn = document.getElementById('add-rule-btn');\nif (addRuleBtn) addRuleBtn.addEventListener('click', () => openModal('modal-add-rule'));\n\nconst addRuleForm = document.getElementById('add-rule-form') as HTMLFormElement;\nif (addRuleForm) {\n    addRuleForm.addEventListener('submit', async (e) => {\n        e.preventDefault();\n        if (currentGroupId === null) return;\n        const valueEl = document.getElementById('new-rule-value') as HTMLInputElement;\n        const commentEl = document.getElementById('new-rule-comment') as HTMLInputElement;\n\n        try {\n            await api(`/api/groups/${currentGroupId}/rules`, {\n                method: 'POST',\n                body: JSON.stringify({ type: currentRuleType, value: valueEl.value, comment: commentEl.value })\n            });\n            closeModal('modal-add-rule');\n            addRuleForm.reset();\n            void loadRules();\n            showToast('Regla a√±adida');\n        } catch (err: any) {\n            showToast(err.message, 'error');\n        }\n    });\n}\n\n// Bulk Add\nconst bulkAddBtn = document.getElementById('bulk-add-btn');\nif (bulkAddBtn) bulkAddBtn.addEventListener('click', () => openModal('modal-bulk-add'));\n\nconst bulkAddForm = document.getElementById('bulk-add-form') as HTMLFormElement;\nif (bulkAddForm) {\n    bulkAddForm.addEventListener('submit', async (e) => {\n        e.preventDefault();\n        if (currentGroupId === null) return;\n        const textEl = document.getElementById('bulk-values') as HTMLTextAreaElement;\n        const text = textEl?.value || '';\n        const values = text.split('\\n').map(v => v.trim()).filter(v => v);\n\n        if (values.length === 0) {\n            showToast('No hay valores para a√±adir', 'error');\n            return;\n        }\n\n        try {\n            const result = await api<{ count: number }>(`/api/groups/${currentGroupId}/rules/bulk`, {\n                method: 'POST',\n                body: JSON.stringify({ type: currentRuleType, values })\n            });\n            closeModal('modal-bulk-add');\n            bulkAddForm.reset();\n            void loadRules();\n            showToast(`${result.count.toString()} reglas a√±adidas`);\n        } catch (err: any) {\n            showToast(err.message, 'error');\n        }\n    });\n}\n\n// ============== Helpers ==============\nfunction escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// ============== System Toggle ==============\nasync function loadSystemStatus(): Promise<void> {\n    try {\n        const status = await api<SystemStatus>('/api/system/status');\n        updateSystemToggleUI(status.enabled);\n    } catch (err) {\n        console.error('Error loading system status:', err);\n    }\n}\n\nfunction updateSystemToggleUI(isEnabled: boolean): void {\n    const toggle = document.getElementById('system-toggle');\n    const icon = document.getElementById('system-status-icon');\n    const text = document.getElementById('system-status-text');\n    const btn = document.getElementById('system-toggle-btn');\n\n    if (!toggle || !icon || !text || !btn) return;\n\n    if (isEnabled) {\n        toggle.classList.remove('inactive');\n        toggle.classList.add('active');\n        icon.textContent = 'üü¢';\n        text.textContent = 'Sistema Activo';\n        btn.textContent = '‚è∏Ô∏è Desactivar Sistema';\n        btn.classList.remove('btn-success');\n        btn.classList.add('btn-danger');\n    } else {\n        toggle.classList.remove('active');\n        toggle.classList.add('inactive');\n        icon.textContent = 'üî¥';\n        text.textContent = 'Sistema Desactivado';\n        btn.textContent = '‚ñ∂Ô∏è Activar Sistema';\n        btn.classList.remove('btn-danger');\n        btn.classList.add('btn-success');\n    }\n}\n\nconst systemToggleBtn = document.getElementById('system-toggle-btn');\nif (systemToggleBtn) {\n    systemToggleBtn.addEventListener('click', async () => {\n        const toggle = document.getElementById('system-toggle');\n        if (!toggle) return;\n        const isCurrentlyEnabled = toggle.classList.contains('active');\n        const action = isCurrentlyEnabled ? 'desactivar' : 'activar';\n\n        if (!confirm(`¬øEst√°s seguro de que deseas ${action} el sistema?\\n\\nEsto afectar√° a TODOS los grupos.`)) {\n            return;\n        }\n\n        try {\n            const result = await api<SystemStatus>('/api/system/toggle', {\n                method: 'POST',\n                body: JSON.stringify({ enable: !isCurrentlyEnabled })\n            });\n            updateSystemToggleUI(result.enabled);\n            void loadDashboard();\n            showToast(`Sistema ${result.enabled ? 'activado' : 'desactivado'} correctamente`);\n        } catch (err) {\n            showToast('Error al cambiar el estado del sistema', 'error');\n        }\n    });\n}\n\n// ============== Init ==============\nvoid checkAuth();\n","usedDeprecatedRules":[]},{"filePath":"/home/run0/whitelist/dashboard/src/types/express-session.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
