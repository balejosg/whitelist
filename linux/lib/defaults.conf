#!/bin/bash

# OpenPath - Strict Internet Access Control
# Copyright (C) 2025 OpenPath Authors
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.

################################################################################
# defaults.conf - Configurable default values
# Part of the OpenPath DNS system v3.5
#
# Override these values via:
# - Environment variables (e.g., OPENPATH_FALLBACK_DNS=1.1.1.1)
# - Custom config file at /etc/openpath/overrides.conf
################################################################################

# Load custom overrides if present (user configuration)
if [ -f /etc/openpath/overrides.conf ]; then
    # shellcheck source=/dev/null
    source /etc/openpath/overrides.conf
fi

# =============================================================================
# DNS Configuration
# =============================================================================

# Primary fallback DNS server (used when upstream detection fails)
# Override: OPENPATH_FALLBACK_DNS environment variable
FALLBACK_DNS_PRIMARY="${OPENPATH_FALLBACK_DNS:-8.8.8.8}"

# Secondary fallback DNS server
# Override: OPENPATH_FALLBACK_DNS_SECONDARY environment variable
FALLBACK_DNS_SECONDARY="${OPENPATH_FALLBACK_DNS_SECONDARY:-8.8.4.4}"

# =============================================================================
# Captive Portal Detection
# =============================================================================

# URL for captive portal detection
# Override: OPENPATH_CAPTIVE_PORTAL_URL environment variable
CAPTIVE_PORTAL_URL="${OPENPATH_CAPTIVE_PORTAL_URL:-http://detectportal.firefox.com/success.txt}"

# Expected response from captive portal check
CAPTIVE_PORTAL_EXPECTED="${OPENPATH_CAPTIVE_PORTAL_EXPECTED:-success}"

# =============================================================================
# Whitelist Configuration
# =============================================================================

# Default whitelist URL (used during initial installation)
# Override: --whitelist-url flag during install
# Override: /etc/openpath/whitelist-url.conf after installation
DEFAULT_WHITELIST_URL="${OPENPATH_DEFAULT_WHITELIST_URL:-https://raw.githubusercontent.com/LasEncinasIT/Whitelist-por-aula/refs/heads/main/Informatica%203.txt}"

# =============================================================================
# Timeouts and Retries
# =============================================================================

# Curl timeout for whitelist download (seconds)
WHITELIST_DOWNLOAD_TIMEOUT="${OPENPATH_DOWNLOAD_TIMEOUT:-30}"

# DNS validation timeout (seconds)
DNS_VALIDATION_TIMEOUT="${OPENPATH_DNS_TIMEOUT:-5}"

# Maximum retries for port 53 freeing
PORT_53_MAX_RETRIES="${OPENPATH_PORT_53_RETRIES:-30}"
